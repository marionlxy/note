## LinuxåŸºç¡€: è¿›ç¨‹åŠè½¯ä»¶å®‰è£…

-Author: bavdu

-Email: bavduer@gmail.com

-Github: https://github.com/bavdu

---

- è¿›ç¨‹å’Œçº¿ç¨‹
- æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹(10000ğŸŒŸ)
- åˆ©ç”¨procæŸ¥çœ‹cpuã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œä¿¡æ¯(100ğŸŒŸ)
- Linuxè½¯ä»¶åŒ…ç®¡ç†æœºåˆ¶
- Yumç®¡ç†è½¯ä»¶åŒ…(10000ğŸŒŸ)
- æºç å®‰è£…(10000ğŸŒŸ)
- æ³¨æ„å¸ƒç½®ä½œä¸šï¼ï¼ï¼

---

##### è¿›ç¨‹å’Œçº¿ç¨‹

```shell
 - è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•å…ƒ,çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒ
 
 - å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´,ä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹(Process)æ¯”å¦‚æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨å°±æ˜¯å¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨è¿›ç¨‹,æ‰“å¼€ä¸€ä¸ªè®°äº‹æœ¬å°±å¯åŠ¨äº†ä¸€ä¸ªè®°äº‹æœ¬è¿›ç¨‹,æ‰“å¼€ä¸¤ä¸ªè®°äº‹æœ¬å°±å¯åŠ¨äº†ä¸¤ä¸ªè®°äº‹æœ¬è¿›ç¨‹,æ‰“å¼€ä¸€ä¸ªWordå°±å¯åŠ¨äº†ä¸€ä¸ªWordè¿›ç¨‹.
 
 - æœ‰äº›è¿›ç¨‹è¿˜ä¸æ­¢åŒæ—¶å¹²ä¸€ä»¶äº‹,æ¯”å¦‚Wordå®ƒå¯ä»¥åŒæ—¶è¿›è¡Œæ‰“å­—ã€æ‹¼å†™æ£€æŸ¥ã€æ‰“å°ç­‰äº‹æƒ….åœ¨ä¸€ä¸ªè¿›ç¨‹å†…éƒ¨,è¦åŒæ—¶å¹²å¤šä»¶äº‹,å°±éœ€è¦åŒæ—¶è¿è¡Œå¤šä¸ªâ€œå­ä»»åŠ¡â€,æˆ‘ä»¬æŠŠè¿›ç¨‹å†…çš„è¿™äº›â€œå­ä»»åŠ¡â€ç§°ä¸ºçº¿ç¨‹(Thread)
```



1bit = 8byte

1kbit = 8*1024byte

##### çŸ¥è¯†ç‚¹

```shell
##æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„ä¿¡æ¯,é™æ€ <topå¯ä»¥åŠ¨æ€æŸ¥çœ‹è¿›ç¨‹çš„ä¿¡æ¯>
[bavduer@system_manager ~]$ sudo ps aux | grep sshd		---ï¼ˆ10000ğŸŒŸï¼‰æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„é™æ€ä¿¡æ¯
USER      PID    %CPU %MEM VSZ    RSS  TTY      STAT START   TIME COMMAND
root      6775   0.0  0.4 112756  4320 ?        Ss   11:13   0:00 /usr/sbin/sshd -D
root      18950  0.0  0.6 161360  6144 ?        Ss   17:12   0:00 sshd: bavduer [priv]
bavduer   18952  0.0  0.2 161360  2348 ?        S    17:12   0:00 sshd: bavduer@pts/0
bavduer   19057  0.0  0.0 112724  988  pts/0    S+   18:09   0:00 grep --color=auto sshd

aux:
	-ax: æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„pidã€ttyã€cmdã€cpuå ç”¨æ€»æ—¶é—´
	-u:  æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ä¸­çš„æ‰€æœ‰ç¡¬ä»¶ä½¿ç”¨ä¿¡æ¯

grep: å¯ä»¥ç”¨æ¥è¿‡æ»¤ç‰¹å®šå­—ç¬¦æˆ–ç‰¹å®šç¨‹åºå grep "stringå­—ç¬¦ä¸²"


        USER: è¿è¡Œè¿›ç¨‹çš„ç”¨æˆ·
        PID:	å­è¿›ç¨‹ID -- ppidçˆ¶è¿›ç¨‹ID
        %CPU:	CPUå ç”¨ç‡ 
        %MEM:	å†…å­˜å ç”¨ç‡memory
        VSZ:	å ç”¨è™šæ‹Ÿå†…å­˜ swap
        RSS:  å ç”¨å®é™…å†…å­˜ é©»ç•™å†…å­˜
        TTY: 	è¿›ç¨‹è¿è¡Œçš„ç»ˆç«¯ 
        STAT:	è¿›ç¨‹çŠ¶æ€
        
        man ps (/STATE)			     

          R 	è¿è¡Œ
          S 	å¯ä¸­æ–­ç¡çœ  Sleep  
          D		ä¸å¯ä¸­æ–­ç¡çœ  (usually IO)       
          T		åœæ­¢çš„è¿›ç¨‹/æš‚åœâ¸ï¸      
          Z		åƒµå°¸è¿›ç¨‹      
          X		æ­»æ‰çš„è¿›ç¨‹ã€äº†è§£ ã€‘ 	
          Ss	sè¿›ç¨‹çš„é¢†å¯¼è€…ï¼Œçˆ¶è¿›ç¨‹ 	  
          S<	ä¼˜å…ˆçº§è¾ƒé«˜çš„è¿›ç¨‹ 	
          SN	Nä¼˜å…ˆçº§è¾ƒä½çš„è¿›ç¨‹ 	 
          R+	+è¡¨ç¤ºæ˜¯å‰å°çš„è¿›ç¨‹ç»„ 	
          Sl	ä»¥çº¿ç¨‹çš„æ–¹å¼è¿è¡Œ	

        START:		è¿›ç¨‹å¯åŠ¨æ—¶çš„æ—¶é—´
        TIME:			è¿›ç¨‹å ç”¨CPUçš„æ€»æ—¶é—´
        COMMAND:	è¿›ç¨‹æ–‡ä»¶,è¿›ç¨‹å 

[bavduer@system_manager ~]$ sudo ss -anptu | grep sshd					ï¼ˆ10000ğŸŒŸï¼‰
Netid  State    Recv-Q  Send-Q Local Address:Port  Peer Address:Port 
tcp    LISTEN   0       128    *:22                *:*  users:(("sshd",pid=6775,fd=3))
tcp    LISTEN   0       128    :::22               :::* users:(("sshd",pid=6775,fd=4))

        Netid: ç½‘ç»œè¿æ¥åè®®
        State: ç›‘å¬çŠ¶æ€
        Recv-Q: ç½‘ç»œæ¥æ”¶é˜Ÿåˆ—
        Send-Q: ç½‘ç»œå‘é€é˜Ÿåˆ—
        Local Address:Port: æœ¬åœ°åœ°å€:ç«¯å£å·
        Peer Address:Port: è¿œç«¯åœ°å€:ç«¯å£å·


[bavduer@system_manager ~]$ sudo netstat -anptu | grep sshd				(10000ğŸŒŸ)
Proto  Recv-Q Send-Q Local Address    Foreign Address       State
tcp        0    0 0.0.0.0:22          0.0.0.0:*             LISTEN      6775/sshd
tcp        0    0 192.168.161.100:22  192.168.161.1:53983   ESTABLISHED 18950/sshd: bavduer
tcp6       0    0 :::22               :::*                  LISTEN      6775/sshd
Recv-Q Send-Qåˆ†åˆ«è¡¨ç¤ºç½‘ç»œæ¥æ”¶é˜Ÿåˆ—ã€å‘é€é˜Ÿåˆ—. Qæ˜¯Queueçš„ç¼©å†™.
è¿™ä¸¤ä¸ªå€¼é€šå¸¸åº”è¯¥ä¸º0,å¦‚æœä¸ä¸º0å¯èƒ½æ˜¯æœ‰é—®é¢˜çš„
```



#####æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹

```shell
[root@linux_basis ~]# ps aux	--é™æ€æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹
USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root          1  4.6  0.1  43360  3716 ?        Ss   18:24   0:01 /usr/lib/systemd/systemd --switche
root          2  0.0  0.0      0     0 ?        S    18:24   0:00 [kthreadd]
root          3  0.2  0.0      0     0 ?        S    18:24   0:00 [ksoftirqd/0]
root          4  0.3  0.0      0     0 ?        R    18:24   0:00 [kworker/0:0]
root          5  0.0  0.0      0     0 ?        S<   18:24   0:00 [kworker/0:0H]
......

[root@linux_basis ~]# ps -ef	--é™æ€æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹
UID         PID   PPID  C STIME TTY          TIME CMD
root          1      0  0 18:24 ?        00:00:01 /usr/lib/systemd/systemd --switched-root
root          2      0  0 18:24 ?        00:00:00 [kthreadd]
root          3      2  0 18:24 ?        00:00:00 [ksoftirqd/0]
root          4      2  0 18:24 ?        00:00:00 [kworker/0:0]
root          5      2  0 18:24 ?        00:00:00 [kworker/0:0H]
......

[root@linux_basis ~]# ps aux | grep sshd		--é™æ€æŸ¥çœ‹æŒ‡å®šçš„è¿›ç¨‹
root       6864  0.0  0.2 112756  4316 ?        Ss   18:24   0:00 /usr/sbin/sshd -D
root       7120  0.0  0.2 157152  6048 ?        Ss   18:24   0:00 sshd: root@pts/0
root       7156  0.0  0.0 112680   736 pts/0    R+   18:29   0:00 grep --color=auto sshd

[root@linux_basis ~]# ps -ef | grep sshd		--é™æ€æŸ¥çœ‹æŒ‡å®šçš„è¿›ç¨‹
root       6864      1  0 18:24 ?        00:00:00 /usr/sbin/sshd -D
root       7120   6864  0 18:24 ?        00:00:00 sshd: root@pts/0
root       7160   7122  0 18:29 pts/0    00:00:00 grep --color=auto sshd

[root@linux_basis ~]# top			--åŠ¨æ€æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹
top - 18:26:17 up 1 min,  1 user,  load average: 0.43, 0.30, 0.12
Tasks: 102 total,   2 running, 100 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :  2028088 total,  1805956 free,    99072 used,   123060 buff/cache
KiB Swap:  2097148 total,  2097148 free,        0 used.  1775696 avail Mem

   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
  6037 root      20   0  300720   6328   4976 R  0.3  0.3   0:00.19 vmtoolsd
     1 root      20   0  125288   3756   2560 S  0.0  0.2   0:01.49 systemd
     2 root      20   0       0      0      0 S  0.0  0.0   0:00.00 kthreadd
     3 root      20   0       0      0      0 S  0.0  0.0   0:00.08 ksoftirqd/0
     4 root      20   0       0      0      0 S  0.0  0.0   0:00.28 kworker/0:0
     5 root       0 -20       0      0      0 S  0.0  0.0   0:00.00 kworker/0:0H
......
```



##### åˆ©ç”¨procæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯(CPU, MEM, Disk, Network)

```shell
[root@linux_basis ~]# ls /proc/
1     1830  30    3119  4976  6066  9            fb           mdstat        stat
10    1837  3008  3143  4983  6145  92           filesystems  meminfo       swaps
11    1839  3009  3146  5     6863  acpi         fs           misc          sys
13    1842  3027  32    5013  6864  asound       interrupts   modules       sysrq-trigger
14    1883  3034  33    5014  6865  buddyinfo    iomem        mounts        sysvipc
15    1885  3037  41    5015  6998  bus          ioports      mpt           timer_list
16    19    3042  43    5017  7     cgroups      irq          mtrr          timer_stats
17    2     3043  44    5564  7007  cmdline      kallsyms     net           tty
1712  20    3046  45    5911  7008  consoles     kcore        pagetypeinfo  uptime
1724  21    3047  47    5921  7187  cpuinfo      key-users    partitions    version
1725  22    3048  4951  5924  7188  crypto       keys         sched_debug   vmallocinfo
1727  23    3049  4956  6     7189  devices      kmsg         schedstat     vmstat
1792  24    3050  4960  60    7190  diskstats    kpagecount   scsi          zoneinfo
1798  2993  3051  4964  6037  7192  dma          kpageflags   self
18    2994  3052  4968  6039  7212  driver       loadavg      slabinfo
1823  3     31    4973  6051  8     execdomains  locks        softirqs
```

```shell
[root@linux_basis ~]# cat /proc/cpuinfo					--æŸ¥çœ‹cpuä¿¡æ¯
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 142
model name	: Intel(R) Core(TM) i5-7267U CPU @ 3.10GHz
stepping	: 9
microcode	: 0x9a
cpu MHz		: 3094.952
cache size	: 4096 KB
physical id	: 0
siblings	: 1
core id		: 0
cpu cores	: 1
apicid		: 0
initial apicid	: 0
fpu		: yes
fpu_exception	: yes
cpuid level	: 22
wp		: yes
......

[root@linux_basis ~]# cat /proc/meminfo				--æŸ¥çœ‹å†…å­˜çš„ä¿¡æ¯
MemTotal:        2028088 kB
MemFree:         1806256 kB
MemAvailable:    1776200 kB
Buffers:            2108 kB
Cached:            81612 kB
SwapCached:            0 kB
Active:            61308 kB
Inactive:          65244 kB
Active(anon):      43244 kB
Inactive(anon):     9308 kB
Active(file):      18064 kB
Inactive(file):    55936 kB
Unevictable:           0 kB
Mlocked:               0 kB
SwapTotal:       2097148 kB
SwapFree:        2097148 kB
Dirty:                 0 kB
Writeback:             0 kB

[root@linux_basis ~]# cat /proc/partitions		--æŸ¥çœ‹ç£ç›˜çš„ä¿¡æ¯
major minor  #blocks  name

   8        0   20971520 sda
   8        1    1048576 sda1
   8        2   19921920 sda2
  11        0    4481024 sr0
 253        0   17821696 dm-0
 253        1    2097152 dm-1
 
[root@linux_basis ~]# ls /proc/net/						--æŸ¥çœ‹ç½‘ç»œè®¾å¤‡ä¿¡æ¯
anycast6           igmp               l2cap              raw6               stat/
arp                igmp6              mcfilter           route              tcp
connector          ip6_flowlabel      mcfilter6          rt6_stats          tcp6
dev                ip6_mr_cache       netfilter/         rt_acct            udp
dev_mcast          ip6_mr_vif         netlink            rt_cache           udp6
dev_snmp6/         ip_mr_cache        netstat            sco                udplite
fib_trie           ip_mr_vif          packet             snmp               udplite6
fib_triestat       ip_tables_matches  protocols          snmp6              unix
hci                ip_tables_names    psched             sockstat           wireless
icmp               ip_tables_targets  ptype              sockstat6          xfrm_stat
if_inet6           ipv6_route         raw                softnet_stat
```



##### Linuxè½¯ä»¶åŒ…ç®¡ç†æœºåˆ¶

```shell
- yumå®‰è£…è½¯ä»¶æ˜¯æ ¹æ®/etc/yum.repos.d/ä¸­å­˜å‚¨çš„ä»¥.repoç»“å°¾çš„ä»“åº“æ–‡ä»¶æ‰€æŒ‡å®šçš„URLä¸­è·å–çš„.
[root@linux_basis ~]# ls /etc/yum.repos.d/
CentOS-Base.repo  epel.repo  tsinghua-base.repo  tsinghua-epel.repo

- å®‰è£…å‘½ä»¤
[root@linux_basis ~]# yum -y install httpd httpd-tools

- å¸è½½å‘½ä»¤
[root@linux_basis ~]# yum -y remove httpd httpd-tools

- æ¸…ç©ºç¼“å­˜
[root@linux_basis ~]# yum clean all

- æ ¹æ®å‘½ä»¤åæŸ¥æ‰¾å®‰è£…åŒ…çš„åå­—(å¸¸ç”¨äºä¸èƒ½å®‰è£…æŒ‡å®šå‘½ä»¤çš„æƒ…å†µ)********yumæŸ¥æ‰¾è½¯ä»¶å®‰è£…åŒ…**************
[root@linux_basis ~]# yum -y install ifconfig
Loading mirror speeds from cached hostfile
No package ifconfig available.
Error: Nothing to do
(ä¸Šè¿°æŠ¥é”™çš„å¤„ç†æ–¹æ³•)
[root@linux_basis ~]# yum provides ifconfig
Loading mirror speeds from cached hostfile
net-tools-2.0-0.24.20131004git.el7.x86_64 : Basic networking tools		##è¿™ä¸€è¡Œæ˜¾ç¤ºè½¯ä»¶åŒ…åå­—
Repo        : @base
Matched from:
Filename    : /usr/sbin/ifconfig
[root@linux_basis ~]# yum -y install net-tools

- è®¾ç½®å®‰è£…æºä»“åº“æ–‡ä»¶
	- è®¾ç½®é˜¿é‡Œäº‘å®˜æ–¹é•œåƒæº(Visit: https://opsx.alibaba.com)
	- è®¾ç½®æ¸…åå¤§å­¦é•œåƒæº(Visit: https://mirrors.tuna.tsinghua.edu.cn)
	
	
[root@linux_basis yum.repos.d]# yum search ifconfig
å·²åŠ è½½æ’ä»¶ï¼šfastestmirror
Loading mirror speeds from cached hostfile
 * epel: mirror.lzu.edu.cn
========================================= åŒ¹é…ï¼šifconfig ==========================================
moreutils.x86_64 : Additional unix utilities
net-tools.x86_64 : Basic networking tools
python2-psutil.x86_64 : A process and system utilities module for Python
python34-psutil.x86_64 : A process and system utilities module for Python
python36-psutil.x86_64 : A process and system utilities module for Python
```



##### æºç å®‰è£…è½¯ä»¶

````shell
[root@VM_0_2_centos ~]# wget http://nginx.org/download/nginx-1.14.2.tar.gz
[root@VM_0_2_centos ~]# tar xf nginx-1.14.2.tar.gz -C /opt/
[root@VM_0_2_centos ~]# cd /opt/nginx-1.14.2/
[root@VM_0_2_centos nginx-1.14.2]# ls
auto  CHANGES  CHANGES.ru  conf  configure  contrib  html  LICENSE  man  README  src
[root@VM_0_2_centos nginx-1.14.2]#

##æ·»åŠ ç”¨æˆ·
[root@VM_0_2_centos nginx-1.14.2]# groupadd -g 966 nginx
[root@VM_0_2_centos nginx-1.14.2]# useradd -s /sbin/nologin -M -u 988 -g 966 nginx
[root@VM_0_2_centos nginx-1.14.2]#
[root@VM_0_2_centos nginx-1.14.2]# id nginx
uid=988(nginx) gid=966(nginx) ç»„=966(nginx)

##å¯åŠ¨å®‰è£…
[root@VM_0_2_centos nginx-1.14.2]# ./configure \			--é¢„ç¼–è¯‘:æŠŠæ‰€æœ‰çš„ç¯å¢ƒå‡†å¤‡å¥½
> --prefix=/usr/local/nginx/ \
> --user=nginx \
> --group=nginx \

........
........
........
creating objs/Makefile

Configuration summary
  + using system PCRE library
  + OpenSSL library is not used
  + using system zlib library

  nginx path prefix: "/usr/local/nginx/"
  nginx binary file: "/usr/local/nginx//sbin/nginx"
  nginx modules path: "/usr/local/nginx//modules"
  nginx configuration prefix: "/usr/local/nginx//conf"
  nginx configuration file: "/usr/local/nginx//conf/nginx.conf"
  nginx pid file: "/usr/local/nginx//logs/nginx.pid"
  nginx error log file: "/usr/local/nginx//logs/error.log"
  nginx http access log file: "/usr/local/nginx//logs/access.log"
  nginx http client request body temporary files: "client_body_temp"
  nginx http proxy temporary files: "proxy_temp"
  nginx http fastcgi temporary files: "fastcgi_temp"
  nginx http uwsgi temporary files: "uwsgi_temp"
  nginx http scgi temporary files: "scgi_temp"

[root@VM_0_2_centos nginx-1.14.2]# echo $?
0
[root@VM_0_2_centos nginx-1.14.2]# make	 ç¼–è¯‘:æŠŠå‡†å¤‡å¥½çš„æ–‡ä»¶ä¸€ä¸€æ”¾åœ¨å¯¹åº”ç›®å½•ä¸­, æˆ–é‡Šæ”¾å®‰è£…æ‰€éœ€è¦çš„æ–‡ä»¶
sed -e "s|%%PREFIX%%|/usr/local/nginx/|" \
	-e "s|%%PID_PATH%%|/usr/local/nginx//logs/nginx.pid|" \
	-e "s|%%CONF_PATH%%|/usr/local/nginx//conf/nginx.conf|" \
	-e "s|%%ERROR_LOG_PATH%%|/usr/local/nginx//logs/error.log|" \
	< man/nginx.8 > objs/nginx.8
make[1]: ç¦»å¼€ç›®å½•â€œ/opt/nginx-1.14.2â€
[root@VM_0_2_centos nginx-1.14.2]# echo $?
0
[root@VM_0_2_centos nginx-1.14.2]# make install å®‰è£…:æŠŠç¼–è¯‘åçš„æ–‡ä»¶æ‹·è´åˆ°å¯¹åº”çš„å®‰è£…ç›®å½•ä¸­
[root@VM_0_2_centos nginx-1.14.2]# echo $?
0


##é”™è¯¯ç¤ºèŒƒ:
1. æœªå®‰è£…gcc gcc-c++è½¯ä»¶åŒ…, ç¼ºå°‘ç¼–è¯‘ç¯å¢ƒ
checking for OS
 + Linux 3.10.0-862.el7.x86_64 x86_64
checking for C compiler ... not found

./configure: error: C compiler cc is not found
è§£å†³åŠæ³•:
$ yum -y groupinstall "Development Tools"

2. ç¼ºå°‘ç›¸åº”çš„å¼€å‘åº“æ–‡ä»¶
./configure: error: the HTTP rewrite module requires the PCRE library.
You can either disable the module by using --without-http_rewrite_module
option, or install the PCRE library into the system, or build the PCRE library
statically from the source with nginx by using --with-pcre=<path> option.
è§£å†³åŠæ³•:
$ yum -y install pcre-devel

3.ç¼ºå°‘ç›¸åº”çš„å¼€å‘åº“æ–‡ä»¶
./configure: error: the HTTP gzip module requires the zlib library.
You can either disable the module by using --without-http_gzip_module
option, or install the zlib library into the system, or build the zlib library
statically from the source with nginx by using --with-zlib=<path> option.
$ yum -y install zlib-devel
--configæŸ¥çœ‹å‚æ•°
echo $?æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸ
è§£å†³å®‰è£…è¿‡ç¨‹ç¼ºå°‘çš„è½¯ä»¶
````

