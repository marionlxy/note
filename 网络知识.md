**网络知识**

###### 面试题

1. 描述一下OSI模型。

   ​	OSI模型把网络通信的工作分为7层，分别是物理层、数据链路层、网络层、传输层、会话层、表示层和应用层

   ![OSI](http://122.51.134.246:9696/images/2019/11/25/QQ20191121142128.md.jpg)

2. 描述一下TCP模型。

   |            |     对应的OSI模型      |                        对应的网络协议                        |
   | :--------: | :--------------------: | :----------------------------------------------------------: |
   |   应用层   | 应用层、表示层、绘画层 | HTTP、TFTP, FTP, NFS, WAIS、SMTP ，Telnet, Rlogin, SNMP, Gopher， SMTP, DNS |
   |   传输层   |         传输层         |                           TCP，UDP                           |
   | 网际互连层 |         网络层         |                IP, ICMP, ARP, RARP, AKP, UUCP                |
   | 网络接入层 |   数据链路层，物理层   | FDDI, Ethernet, Arpanet, PDN, SLIP, PPP， IEEE 802.1A, IEEE 802.2到IEEE 802.11 |

   ​													4层网络模型（公司常用的网络模型）

   ![4层模型](http://122.51.134.246:9696/images/2019/11/25/QQ20191121142146.md.png)

3. 描述一下TCP三次握手和四次挥手。

   ```
   三次握手过程：
   	【客户端】发送SYN（seq = x）报文（注释：SYN创建一个连接）===>>【服务器】，然后【客户端】进入SYN_SENT状态（注释：SYN_SENT发送状态）；
   	【服务器】收到SYN报文，回应一个SYN（seq = y） ACK （ACK = x + 1）报文（注释：ACK确认接受到的数据）===>>【客户端】，然后【服务器】进入SYN_RCVD状态（注释：SYN_RCVD是指服务端被动打开后,接收到了客户端的SYN并且发送了ACK时的状态。已接受状态）；
   	【客户端】收到SYN报文后，回应了一个ACK（ACK = y + 1）===>>【服务器】,【客户端】进入ESTABLISHED状态（注释：ESTABLISHED表示建立连接，一个打开的连接）；【服务器】收到ACK报文后，进入ESTABLISHED状态。
   	
   	
   四次挥手过程：
   	【A】某个进程主动关闭连接，发送FIN（seq = u）报文（注释：FIN终结一个连接）===>>【B】,然后【A】进入FIN_WAIT_1状态（注释：FIN_WAIT_1等待远程TCP连接中断请求，或先前的连接中断请求的确认，客户端发送连接中断请求后将FIN至一，并进入FIN-WAIT-1状态）；
   	【B】收到FIN报文，回应一个ACK（ACK = u + 1）报文===>>【A】，然后【B】进入CLOSED_WAIT状态（注释：CLOSED_WAIT等待从本地用户发来的连接中断请求，服务器对客户机的连接中断请求的确认后进入CLOSE-WAIT状态）；【A】收到FIN报文，进入FIN_WAIT_2状态（注释：FIN_WAIT_2从远程TCP等待连接中断请求，客户端收到FIN报文，确认后进入此状态）；
   	【B】发送FIN（seq = v ）报文===>>【A】，然后【B】进入LAST_ACK状态（注释：LAST_ACK等待原来的发向远程TCP的连接中断请求的确认）；
   	【A】收到FIN报文后，发送ACK（ACK = v + 1）报文===>>【B】，然后【A】进入TIME_WAIT状态（注释：TIME_WAIT等待足够的时间以确保远程TCP接收到连接中断请求的确认）。
   ```

   ![20170607205709367.gif](http://122.51.134.246:9696/images/2019/11/25/20170607205709367.gif)

   ​																	**三次握手**

   ![20170607205756255.gif](http://122.51.134.246:9696/images/2019/11/25/20170607205756255.gif)

   ​																	**四次挥手**

4. 为什么要三次握手，4次挥手？

   ```网络原理
   三次挥手：
   	为了放置已失效的连接请求报文段突然又传送到了服务端，因而产生错误，导致服务器端的一直等待而浪费资源。
   	比如说：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。于是就向client发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据。但server却以为新的运输连接已经建立，并一直等待client发来数据。这样，server的很多资源就白白浪费掉了。采用“三次握手”的办法可以防止上述现象发生。例如刚才那种情况，client不会向server的确认发出确认。server由于收不到确认，就知道client并没有要求建立连接。”
   
   四次挥手：
   	TCP协议是一种面向连接的、可靠的、基于字节流的运输层通信协议。TCP是全双工模式，这就意味着，当主机1发出FIN报文段时，只是表示主机1已经没有数据要发送了，主机1告诉主机2，它的数据已经全部发送完毕了；但是，这个时候主机1还是可以接受来自主机2的数据；当主机2返回ACK报文段时，表示它已经知道主机1没有数据发送了，但是主机2还是可以发送数据到主机1的；当主机2也发送了FIN报文段时，这个时候就表示主机2也没有数据要发送了，就会告诉主机1，我也没有数据要发送了，之后彼此就会愉快的中断这次TCP连接。
   
   ```

5. 如果已经建立连接，但客户端突然出现故障了怎么办？

   ```TCP
   TCP设有一个保活计时器，如果客户端出现故障，服务器会在计时器时长内等待客户端的数据。这个计时器时长通常设置为2小时，每次接收客户端请求后都会重新复位这个计时器。若2小时后还没收到客户端的任何数据，服务器会发送一个探测报文段，每隔75秒发送一次，若发送10次探测报文仍没反应，服务器就认为客户端出现故障，关闭连接。
   ```

   

6. DHCP网络协议

   ```shell
   DHCP工作原理：工作在udp67、68端口、ipv6也有一个端口
   客户端从服务端获取IP的四个租约过程：客户机请求ip，服务器相应请求，客户机选择ip，服务器确定租约。
   客户机请求ip：客户端通过MAC广播，寻找DHCP服务器，请求分配IP。
   服务器相应请求：DHCP服务器得到请求消息，通过广播回应，(有可能有多个DHCP同时响应，原则上谁响应的快，客户端得到谁的)。
   客户机选择ip：客户端得到IP后，通过广播通知所有端口已经得到IP。
   服务器确定租约：分配IP的DHCP服务器广播回应确认，并以单播方式确定租约。
   
   ```

   

7. DNS协议

   ```DNS
   DNS工作原理：工作在tcp和udp的53端口上
   
   本地系统先在本地hosts文件中查找ip映射关系，如果没有，则查找本地DNS缓存器缓存，如果没有，则向自己设定的首选DNS服务器发起请求。
   
   客户端向本地域名服务器的查询一般都是采用递归查询；如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其它根域名服务器继续发出查询，而不是让客户端自己进行下一步查询。
   客户端向本地域名服务器进行查询：如果本地域名服务器有缓存，则直接返回FQDN
   否则：
   本地域名服务器向根域名服务器的查询的迭代查询：当根域名服务器收到本地域名服务器发出的迭代查询请求时，要么给出所要查询的IP地址，要么告诉本地服务器应当继续寻找哪个域名服务器继续查询。此过程重复，直到找到对应的IP地址，或者报错。整个过程都时本地域名服务器在做查询操作。
   
   ```

   

8. TCP与UDP的区别

   ```shell
   1. TCP是面向连接协议，UDP是无连接协议
      TCP 发送数据前使用三次握手建立连接，UDP 发送数据前不需要建立连接。
   
   2. TCP是可靠的，UDP是不可靠的
      TCP 丢包会自动重传，UDP 不会(任何必需的可靠性必须由应用层来提供)。 TCP 可靠性由三个机制保证：1. 序号（TCP 报文的序号）2. 确认（ACK 机制）3. 重传（超时或者冗余的 ACK）
      
   3. TCP无界，UDP有界
      TCP通过字节流传输，UDP中每一个包都是单独的。
   
   4. TCP有序，UDP无序
      消息在传输过程中可能会乱序，后发送的消息可能会先到达，TCP会对其进行重新排序，UDP不会。
   	
   5. TCP有流量控制（拥塞控制），UDP没有
      TCP协议的流量控制是基于滑窗协议实现的。 拥塞控制和流量控制不同，流量控制是点对点的通信量抑制，抑制发送端发送速率，使得接收端来得及接收。
   
   6. TCP 传输慢，UDP 传输快；
      因为 TCP 需要建立连接、保证可靠性和有序性，所以比较耗时。 这就是为什么视频流、广播电视、在线多媒体游戏等选择使用 UDP。
   
   7. TCP 是重量级的，UDP 是轻量级的
      TCP 要建立连接、保证可靠性和有序性，就会传输更多的信息，如 TCP 的包头比较大。
   
   8. TCP 的 头部比 UDP 大
      TCP-Segment-Format
      UDP-Datagram-Format
   
   总结：
   
   TCP 是面向连接的、可靠的、有序的、速度慢的协议；UDP 是无连接的、不可靠的、无序的、速度快的协议。
   TCP 开销比 UDP 大，TCP 头部需要 20 字节，UDP 头部只要 8 个字节。
   TCP 无界有拥塞控制，UDP 有界无拥塞控制。
   ```

9. ICMP协议

   ```icmp
   	ICMP即互联网控制消息协议，与IP协议一样同属于TCP/IP模型中的网络层，并且ICMP包是包裹在IP数据包中的。它的作用是报告一些网络传输过程中的错误与一些同步工作。
   ```

   ![img](https://upload-images.jianshu.io/upload_images/301894-81b2751a8d51c814.png?imageMogr2/auto-orient/strip|imageView2/2/w/857/format/webp)

   

10. HTTP协议包括哪些请求

   ```http
   HTTP 定义了与服务器交互的不同方法，最常见的方法有5种，分别是GET，POST，PUT，DELETE，HEAD
   GET 请求会显示请求的指定资源，一般只用于数据的读取。
   HEAD HEAD与GET一样，向服务器发出指定资源请求。但是服务器响应请求不会回传资源资源的内容部分。常用于查看服务器性能。
   POST 向服务器提交数据，请求服务器处理
   PUT 从客户端向服务器传送的数据取代指定的文档的内容
   DELETE 请求服务器删除指定页面（URL标识的资源）
   ```

11. Mysql 的主从同步延迟怎么解决？

    ```mysql
    	主从同步延迟的排查思路，首先先从业务入手，比如今天是不是有推广活动导致有大量数据写入数据库导致主从同步延迟。
    	主从延迟产生的原因就是主机产生binlog的速度远远高于从机消费binlog的速度。
    	首先先想到网络：
    		网络可能是导致主从延迟的问题，主库或者从库带宽占满，导致主从之间的网络延迟很大。
    		
    	如果IO线程能实时将对应的binlog，就说明不是网络延迟的问题。
    	
    	然后考虑机器性能：
    		从机性能是否太差，导致主从延迟？从机负载过高，导致主从延迟？我们可以使用`top`命令查看从机的负载。是否是从机磁盘问题？有时候磁盘在做完raid后会出现单个IO延迟很高的情况。使用`iostat`命令查看DB数据盘的IO情况。
    		
    	再考虑是否有大事务，锁冲突，参数，多线程，组提交（这个就得需要一些DBA的知识了，我也是仅仅知道而已）
    	
    	总结一下：
    		网络、性能、配置（参数优化）、大事务、锁、多线程复制（5.6才支持的多线程复制）、组提交
    ```

12. TCP连接超时怎么解决？

    ```http
    	首先考虑网络（从前端，到后端，再到内网检测ICMP包）`ping一下`，如果icmp没问题，就可以排除网络问题
    	然后再用tcpdump抓包（抓取双方服务器，网络通讯数据包）发现ICMP，http协议均无问题，只有TCP出现问题，那么问题就来了。
    	难道TCP连接跑满了？
    	从TCP抓包来看，问题描述：TCP Retransmission
    	SYN 重传，说明第三次握手被重传了，没有收到服务器发的ACK确认，说明服务器接收了请求但没有回应ACK。联想以前遇到过的NAT环境下，当多个客户端使用同一个外网IP通过NAT访问内网服务器是，如果服务器内核参数打开了net.ipv4.tcp_tw_recycle = 1，就有可能导致服务器收到SYN但不会向客户端发送SYN+ACK包。打开recyle参数后会识别这些包的时间戳（net.ipv4.tcp_timestamps = 1），但是NAT环境下传过来的数据包又因为时间戳可能不是顺序的，导致服务器认为包不可用而丢弃。
    	
    	当我们使用阿里云的VPC虚拟专网时，使用弹性IP接入，一定要注意NAT问题，再内核参数文件中关闭net.ipv4.tcp_tw_recycle。 否则从一个ip来的不同客户端请求很有可能导致大量请求失败。
    	
    	`vim /etc/sysctl.conf`
    	net.ipv4.tcp_tw_recycle=0
    	net.ipv4.tcp_timestamps=0
    	`sysctl -p`
    ```

13. HTTP的连接方式

    ```shell
    HTTP支持2种连接方式：非持久连接和持久连接（HTTP1.0默认使用的是非持久化连接，HTTP1.1默认是持久化连接）也叫长连接和短链接
    短连接：
    	客户与服务器每进行一次HTTP操作，就要建立一次连接，任务结束就中断连接。
    长连接：
    	如果使用的是长连接模式，会在响应头里加入这行代码`Connection:keep-alive`
    	在使用长连接的情况下，当一个任务完成之后不会立即关闭TCP连接，客户端下次访问还是使用这个连接。`Keep-Alive`不会永久保持连接，它有一个保持时间，可以在不同的服务器软件中设定这个时间。比如Nginx的time_out
    
    ```

14. 长连接和短连接的操作过程

    ```http
    短连接的操作步骤是：
    建立连接——数据传输——关闭连接...建立连接——数据传输——关闭连接
    长连接的操作步骤是：
    建立连接——数据传输...（保持连接）...数据传输——关闭连接
    ```

15. 长连接和短链接的优点和缺点

    ```http
    长连接可以省去较多的TCP建立和关闭的操作，减少浪费，节约时间。对于频繁请求资源的客户来说，较适用长连接。不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，Client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可 以避免一些恶意连接导致server端服务受损；如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服务。
    
    短连接对于服务器来说管理较为简单，存在的连接都是有用的连接，不需要额外的控制手段。但如果客户请求频繁，将在TCP的建立和关闭操作上浪费时间和带宽。
    
    长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。
    ```

16. 什么时候用长连接，短链接？

    ```http
    　长连接多用于操作频繁，点对点的通讯，而且连接数不能太多情况，。每个TCP连接都需要三步握手，这需要时间，如果每个操作都是先连接，再操作的话那么处理速度会降低很多，所以每个操作完后都不断开，次处理时直接发送数据包就OK了，不用建立TCP连接。例如：数据库的连接用长连接， 如果用短连接频繁的通信会造成socket错误，而且频繁的socket 创建也是对资源的浪费。 
      
    　　而像WEB网站的http服务一般都用短链接，因为长连接对于服务端来说会耗费一定的资源，而像WEB网站这么频繁的成千上万甚至上亿客户端的连接用短连接会更省一些资源，如果用长连接，而且同时有成千上万的用户，如果每个用户都占用一个连接的话，那可想而知吧。所以并发量大，但每个用户无需频繁操作情况下需用短连好。
    ```

17. HTTP协议与TCP/IP协议的关系

    ```http
    HTTP的长连接和短连接本质上是TCP长连接和短连接。HTTP属于应用层协议，在传输层使用TCP协议，在网络层使用IP协议。IP协议主要解决网络路由和寻址问题，TCP协议主要解决如何在IP层之上可靠的传递数据包，使在网络上的另一端收到发端发出的所有包，并且顺序与发出顺序一致。TCP有可靠，面向连接的特点。
    ```

18. 如何理解HTTP协议是无状态的

    ```http
    HTTP协议是无状态的，指的是协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态。也就是说，打开一个服务器上的网页和你之前打开这个服务器上的网页之间没有任何联系。HTTP是一个无状态的面向连接的协议，无状态不代表HTTP不能保持TCP连接，更不能代表HTTP使用的是UDP协议（无连接）。
    ```

19. 交换机和集线器有什么区别？

    ```http
      最主要区别：
    
       集线器：20兆宽带四台PC机通过网线连接在集线器上的话，那么每台PC机只能使用五兆宽带
    
       交换机：20兆宽带四台PC机通过网线连接在交换机上的话，那么就是每台PC机都可以使用20宽带
    
       总结：集线器20兆宽带分多个端口使用，采用共享宽带的工作方式 
    
             交换机是一个独享的通道，它能确保每个端口使用宽带都是20兆
    ```

20. VMware Workstation有哪几种上网模式？请形容一下它们

    ```VMware
    桥接模式：
    	相当于在局域网中虚拟出来了一台独立的PC机，他跟局域网中的PC机师对等的关系，在设置桥接模式时需要将网段设置跟局域网一样的网段和网关。
    	
    NAT模式：
    	让虚拟机借助NAT（网络地址转换）功能，通过宿主机所在的网络来访问公网。就像我们在局域网中连接路由器上网一样，我们的IP就会变成1.0网段，就是做了NAT转换。
    	这个时候，局域网的PC机拼不通我的笔记本电脑，但我的笔记本电脑能通过路由器拼得通局域网里面的任何一台PC机，而虚拟机桥接模式就是通过这种方式上网，通过我的物理机去上网，你的物理机就相当于做了路由器。
    	
    仅主机模式：
    	就是将真实环境和虚拟机隔开，在这种模式下，你所有的虚拟机都可以与你的物理机连通，相当于他们用双绞线连接，但是虚拟机系统与真实网络是被隔离开来的，所以你选择仅主机模式是上不了外网的。
    ```

21. TCP端口状态ESTABLISHED、TIME_WAIT、CLOSE_WAIT、SYN_SENT分别代表什么意思？怎么优化TIME_WAIT？

    ```http
    ESTABLISHED：已经建立TCP连接，表示两台机器真正通信
    TIME_WAIT：主动关闭连接的一方进入的时间等待状态（等待2MSL时间）
    CLOSE_WAIT：对方主动关闭连接或网络异常导致的连接中断，这是我方进入关闭等待状态CLOSE_WAIT
    SYN_SENT：表示请求连接
    
    如果网络变慢了，第一件事事查看网络`netstat -a | grep TIME_WAIT | wc -l` 如果发现TIME_WAIT过多的话，修改内核参数
       net.ipv4.tcp_tw_recycle = 1
    
       net.ipv4.tcp_tw_reuse = 1
    
       net.ipv4.tcp_timestamps = 1
    ```

22. TCP 与 UDP的区别？

    ```http
    TCP是面向连接，可靠的字节流服务。
    UDP是面向无连接的，不可靠的数据报服务。
    ```

23. shell中"."和"source"有什么区别？

    ```shell
       .是新产生一个shell，然后执行相应的脚本
    
       source是在当前shell下执行，不再启用其它shell
    ```

24. 讲述一下IP地址的分类

    ```IP
      A类地址：10.0.0.0-126.255.255.255    默认子网掩网码/8，即255.0.0.0  (其中127.0.0.0~127.255.255.255为环回地址,用于本地环回测试等用途)
    
       B类地址：128.0.0.0-191.255.255.255   默认子网掩码/16,即255.255.0.0
    
       C类地址：192.0.0.0-223.255.255.255   默认子网掩码/24,即255.255.255.0
    
       D类地址：224.0.0.0-239.255.255.255   一般于用组播
    
       E类地址：240.0.0.0-255.255.255.255   E类地址一般用于研究用途(其中255.255.255.255为全网广播地址)
    
    ```

25. 解释一下HTTP返回状态码200、201、400、401、403、404、405、413、414、500、501、502、503、504、505？

    ```http
        200  一切正常
    
        301  永久跳转
    
        400  请求出现语法错误
    
        401  客户试图未经授权访问受密码保护的页面
    
        403  禁止访问，资源不可用，通常由于服务器文件或目录的权限设置导致。 
    
        404  无法找到指定位置的资源
    
        405  请求方法对指定的资源不适用
    
        406  指定的资源已经找到，但它的MIME类型和客户在Accpet头中所指定的不兼容
    
        414  请求的URL太长
    
        500  内部服务器错误，服务器遇到了意料不到的情况，一般为程序问题
    
        501  服务器不支持实现请求所需要的功能
    
        502  坏的网关，一般是网关服务器请求后端服务时，后端服务没有按照http协议正确返回结果
    
        503  服务器由于维护或者负载过重未能应答
    
        504  网关超时，一般是网关服务器请求后端服务时，且端服务没有在特定的时间内完成任务
    
        505  服务器不支持请求中所指明的HTTP版本
    
    ```

26. 用tcpdump命令监听192.168.1.1主机和80端口

    ```shell
    tcpdump -vnn -i any host 192.168.161.10 and port 80
    ```

27. 服务器出现网络故障怎么解决？

    ```
    首先用ping、traceroute、dig、nslookup,tracert这些进行排障。另外再检查IP、网关、DNS这些配置。
    ```

28. 你所知道的DNS服务器

    ```dns
        223.5.5.5        浙江省杭州市 电信
    
        223.6.6.6        浙江省杭州市 电信
    
        202.96.128.86    广东省广州市 电信
    
        202.96.128.166   广东省广州市 电信
    
        114.114.114.114  江苏省南京市 电信
    ```

29. ping命令使用的是什么协议？

    ```http
    ICMP协议
    ```

30. 什么是路由器？

    ```shell
    路由器，将因特网中各局域网、广域网的设备，又称网关设备。
    用于连接多个逻辑上分开的网络，所谓逻辑网络是代表一个单独的网络或者一个子网。当数据从一个子网传输到另一个子网时，可通过路由器的路由功能来完成。
    ```

    

